<!DOCTYPE html>
<html>
<head>
    <title>Chatbot V21.1 - B·ªô N√£o ƒêa NƒÉng</title>
    <style>
        /* CSS (Gi·ªØ nguy√™n) */
        body { font-family: sans-serif; margin: 0; padding: 0; background-color: #f2f2f2; }
        #chat-container { width: 100%; max-width: 600px; margin: 0 auto; background-color: white; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); display: flex; flex-direction: column; height: 100vh; }
        #header { 
            background-color: #007bff; 
            color: white; 
            padding: 15px; 
            font-size: 1.1em; 
            font-weight: bold; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
        }
        .reset-btn { 
            background-color: #f44336; 
            border: none; 
            color: white; 
            padding: 5px 8px; 
            border-radius: 12px; 
            cursor: pointer; 
            font-size: 0.75em; 
            margin-left: 10px; 
            line-height: 1; 
        }
        .reset-btn:hover { background-color: #d32f2f; }

        #chat-window { flex-grow: 1; padding: 10px; overflow-y: auto; display: flex; flex-direction: column; gap: 8px; }
        .message { padding: 8px 12px; border-radius: 15px; max-width: 80%; line-height: 1.4; word-wrap: break-word; font-size: 0.95em; }
        .user-message { background-color: #007bff; color: white; align-self: flex-end; border-top-right-radius: 5px; }
        .bot-message { background-color: #e6e6e6; color: #333; align-self: flex-start; border-top-left-radius: 5px; }
        .error-message { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; padding: 15px; border-radius: 5px; font-weight: bold; }
        .loading-message { background-color: #fff3cd; color: #856404; font-style: italic; }
        #input-container { display: flex; padding: 10px; border-top: 1px solid #ccc; }
        #user-input { flex-grow: 1; padding: 10px; border: 1px solid #ccc; border-radius: 20px; margin-right: 10px; font-size: 1em; }
        button { background-color: #28a745; color: white; border: none; padding: 10px 15px; border-radius: 20px; cursor: pointer; font-size: 1em; }
        button:hover { background-color: #218838; }
        .keyword-list { list-style-type: disc; padding-left: 20px; margin-top: 5px; }
        .keyword-list li { padding: 2px 0; font-size: 0.9em; }
        mjx-container { vertical-align: middle !important; }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" id="MathJax-script" async></script>
</head>
<body>
    <div id="chat-container">
        <div id="header">
            ü§ñ Chatbot V21.1 - B·ªô N√£o ƒêa NƒÉng 
            <button class="reset-btn" onclick="clearHistoryAndReload()">X√≥a L·ªãch S·ª≠ Chat</button>
        </div>
        <div id="chat-window">
            </div>
        <div id="input-container">
            <input type="text" id="user-input" placeholder="Nh·∫≠p c√¢u h·ªèi (!HOC, !XEM, !DANHGON)">
            <button onclick="sendMessage()">G·ª≠i</button>
        </div>
    </div>

<script>
    // ======================================================================
    // I. KH·ªêI D·ªÆ LI·ªÜU KI·∫æN TH·ª®C JSON (PH·∫¶N A - C·ªêT L√ïI)
    // ======================================================================
    let knowledgeData = {}; 
    let currentKnowledge = null; 

    // S·ª¨ D·ª§NG D·∫§U NH√ÅY K√âP " " CHU·∫®N JSON ƒê·ªÇ KH·∫ÆC PH·ª§C L·ªñI C√ö PH√ÅP
    const CORE_KNOWLEDGE_JSON = `{
        "vn_animal": "Con v·∫≠t bi·ªÉu t∆∞·ª£ng c·ªßa Vi·ªát Nam th∆∞·ªùng l√† R·ªìng ho·∫∑c L·∫°c Vi·ªát.",
        "nguoi_tao_ra_ban_la_ai": "T√¥i ƒë∆∞·ª£c l·∫≠p tr√¨nh v√† t·∫°o ra d·ª±a tr√™n ki·∫øn th·ª©c JavaScript/HTML.",
        "chao": "üëã Ch√†o b·∫°n! T√¥i c√≥ th·ªÉ gi√∫p g√¨ cho b·∫°n h√¥m nay? H√£y nh·∫≠p t·ª´ kh√≥a ho·∫∑c d√πng l·ªánh **!HOC**.",
        "hello": "üëã Hello! How can I help you today? Please enter a keyword or use the **!HOC** command.",
        "cam_on": "üòä R·∫•t vui ƒë∆∞·ª£c ph·ª•c v·ª•! N·∫øu c√≥ b·∫•t k·ª≥ c√¢u h·ªèi n√†o, c·ª© h·ªèi t√¥i nh√©.",
        "thank_you": "üòä You're very welcome! If you have any questions, just ask.",
        "ten_ban_la_gi": "ü§ñ T√¥i l√† Chatbot V21.1, ƒë∆∞·ª£c t·∫°o ra ƒë·ªÉ gi√∫p b·∫°n h·ªçc v√† qu·∫£n l√Ω ki·∫øn th·ª©c ri√™ng.",
        "thu_do_viet_nam": "Th·ªß ƒë√¥ c·ªßa Vi·ªát Nam l√† H√† N·ªôi.",
        "cong_thuc_nuoc": "C√¥ng th·ª©c h√≥a h·ªçc c·ªßa n∆∞·ªõc l√† $H_2O$.",
        "nha_bac_hoc_noi_tieng": "Albert Einstein l√† m·ªôt trong nh·ªØng nh√† khoa h·ªçc vƒ© ƒë·∫°i nh·∫•t, n·ªïi ti·∫øng v·ªõi Thuy·∫øt t∆∞∆°ng ƒë·ªëi.",
        "bitcoin_la_gi": "Bitcoin l√† lo·∫°i ti·ªÅn m√£ h√≥a phi t·∫≠p trung ƒë·∫ßu ti√™n, ƒë∆∞·ª£c t·∫°o ra v√†o nƒÉm 2009.",
        "loi_ich_cua_javascript": "JavaScript l√† ng√¥n ng·ªØ l·∫≠p tr√¨nh gi√∫p t·∫°o ra c√°c trang web t∆∞∆°ng t√°c v√† ho·∫°t ƒë·ªông tr√™n c·∫£ Front-end v√† Back-end."
    }`;


    // ======================================================================
    // II. C√ÅC H√ÄM TI·ªÜN √çCH V√Ä L∆ØU TR·ªÆ (LOCAL STORAGE)
    // ======================================================================
    const STORAGE_KEY_CHAT = 'chatbot_chat_history';
    const STORAGE_KEY_KNOWLEDGE = 'chatbot_knowledge_data';
    const IGNORE_WORDS = ['la', 'la_gi', 'cua', 'va', 'mot', 'trong', 'duoc', 'co', 'voi', 'toi', 'ban'];

    // H√†m lo·∫°i b·ªè d·∫•u ti·∫øng Vi·ªát v√† chu·∫©n h√≥a chu·ªói
    function normalizeString(str) {
        if (!str) return '';
        return str.toLowerCase()
                  .normalize("NFD") 
                  .replace(/[\u0300-\u036f]/g, "") 
                  .replace(/ƒë/g, "d") 
                  .replace(/[^a-z0-9_ ]/g, "") 
                  .trim()
                  .replace(/\s+/g, "_"); 
    }

    function saveState() {
        const chatWindow = document.getElementById('chat-window');
        const chatContent = chatWindow.innerHTML;
        localStorage.setItem(STORAGE_KEY_CHAT, chatContent);
        localStorage.setItem(STORAGE_KEY_KNOWLEDGE, JSON.stringify(knowledgeData));
    }
    
    function clearHistoryAndReload() {
        if (confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a TO√ÄN B·ªò l·ªãch s·ª≠ tr√≤ chuy·ªán kh√¥ng? (Ki·∫øn th·ª©c ƒë√£ h·ªçc qua l·ªánh !HOC s·∫Ω ƒë∆∞·ª£c gi·ªØ l·∫°i)")) {
            localStorage.removeItem(STORAGE_KEY_CHAT); 
            location.reload(); 
        }
    }

    async function loadChatbotData() {
        try {
            // 1. T·∫£i ki·∫øn th·ª©c c·ªët l√µi (t·ª´ bi·∫øn JavaScript)
            let currentKnowledgeData = JSON.parse(CORE_KNOWLEDGE_JSON);
            
            // 2. T·∫£i ki·∫øn th·ª©c m·ªü r·ªông t·ª´ knowledge.json (Async)
            let loadingMessage = appendMessage("ƒêang t·∫£i ki·∫øn th·ª©c t·ª´ file knowledge.json...", 'bot', true, 'loading-message');
            
            try {
                const response = await fetch('knowledge.json');
                if (!response.ok) {
                     throw new Error(`HTTP error! status: ${response.status}`);
                }
                const text = await response.text();
                
                const cleanedText = text.startsWith('\ufeff') ? text.substring(1) : text;
                
                const externalKnowledge = JSON.parse(cleanedText);
                
                currentKnowledgeData = { ...currentKnowledgeData, ...externalKnowledge };
                
                loadingMessage.className = 'message bot-message';
                loadingMessage.innerHTML = '‚úÖ **T·∫£i ki·∫øn th·ª©c th√†nh c√¥ng!** (ƒê√£ h·ª£p nh·∫•t t·ª´ file knowledge.json).';
                
            } catch (fetchError) {
                loadingMessage.className = 'message bot-message error-message';
                loadingMessage.innerHTML = `‚ö†Ô∏è **L·ªói:** Kh√¥ng th·ªÉ t·∫£i ho·∫∑c ph√¢n t√≠ch file **knowledge.json**. Vui l√≤ng ki·ªÉm tra file ƒë√£ t·ªìn t·∫°i v√† ƒë√∫ng ƒë·ªãnh d·∫°ng JSON ch∆∞a. (S·ª≠ d·ª•ng ki·∫øn th·ª©c g·ªëc).`;
            }

            // 3. T·∫£i ki·∫øn th·ª©c ƒë√£ l∆∞u tr·ªØ (Local Storage - ∆∞u ti√™n cao nh·∫•t)
            const storedKnowledge = localStorage.getItem(STORAGE_KEY_KNOWLEDGE);
            if (storedKnowledge) {
                currentKnowledgeData = { ...currentKnowledgeData, ...JSON.parse(storedKnowledge) };
            }

            knowledgeData = currentKnowledgeData;
            
            // 4. T·∫£i l·ªãch s·ª≠ chat
            const storedChat = localStorage.getItem(STORAGE_KEY_CHAT);
            const chatWindow = document.getElementById('chat-window');
            if (storedChat) {
                chatWindow.innerHTML = storedChat;
            } else {
                appendMessage(knowledgeData['chao'] || knowledgeData['hello'], 'bot');
            }
            
            chatWindow.scrollTop = chatWindow.scrollHeight;
            
        } catch (error) {
            console.error("L·ªói t·∫£i d·ªØ li·ªáu JSON c·ªët l√µi:", error);
            appendMessage(`‚ö†Ô∏è **L·ªói nghi√™m tr·ªçng:** Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu ki·∫øn th·ª©c JSON c·ªët l√µi. Vui l√≤ng ki·ªÉm tra l·∫°i c√∫ ph√°p JSON trong bi·∫øn \`CORE_KNOWLEDGE_JSON\`. (L·ªói: ${error.message})`, 'bot', true, 'error-message');
        }
    }


    // ======================================================================
    // III. CORE CHAT FUNCTIONS
    // ======================================================================

    function appendMessage(text, sender, skipSave = false, additionalClass = '') {
        const chatWindow = document.getElementById('chat-window');
        const messageDiv = document.createElement('div');
        
        messageDiv.className = `message ${sender}-message ${additionalClass}`;
        messageDiv.innerHTML = text; 
        
        chatWindow.appendChild(messageDiv);
        chatWindow.scrollTop = chatWindow.scrollHeight;
        
        if (sender === 'bot') {
            if (text.includes('üí° [PH·∫¢N H·ªíI KI·∫æN TH·ª®C]')) {
                currentKnowledge = text.replace('üí° [PH·∫¢N H·ªíI KI·∫æN TH·ª®C] ', '');
            } else {
                currentKnowledge = null; 
            }
        } 
        
        if (!skipSave) {
            saveState();
        }
        
        if (typeof MathJax !== 'undefined') {
            MathJax.typeset([messageDiv]);
        }

        return messageDiv;
    }

    // H√ÄM G·ªåI API B√äN NGO√ÄI (PH∆Ø∆†NG √ÅN 1)
    async function getNewQuote() {
        try {
            // ƒê√¢y l√† m·ªôt API c√¥ng c·ªông, kh√¥ng c·∫ßn Key
            const response = await fetch('https://api.quotable.io/random'); 
            
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            
            const data = await response.json(); 
            const quote = data.content;
            const author = data.author;

            return `üìö **Danh ng√¥n ng·∫´u nhi√™n (T·ª´ Internet):** "${quote}" - *${author}*`;
        } catch (error) {
            console.error("L·ªói khi g·ªçi API danh ng√¥n:", error);
            // L·ªói n√†y th∆∞·ªùng x·∫£y ra do quy t·∫Øc CORS khi ch·∫°y file c·ª•c b·ªô
            return `‚ö†Ô∏è **L·ªñI K·∫æT N·ªêI INTERNET:** Kh√¥ng th·ªÉ t·∫£i danh ng√¥n. Khi ch·∫°y file tr·ª±c ti·∫øp tr√™n m√°y, b·∫°n c√≥ th·ªÉ b·ªã ch·∫∑n b·ªüi l·ªói b·∫£o m·∫≠t (CORS). (L·ªói: ${error.message})`;
        }
    }


    // H√ÄM T√åM KI·∫æM C√ì ƒê·ªò ∆ØU TI√äN TH·∫§P H∆†N (PH∆Ø∆†NG √ÅN 2 - LINH HO·∫†T)
    function findFlexibleKnowledge(query) {
        const normalizedQuery = normalizeString(query); 
        
        // 1. Ki·ªÉm tra ch√≠nh x√°c Key (∆Øu ti√™n cao nh·∫•t)
        if (knowledgeData.hasOwnProperty(normalizedQuery)) {
            return knowledgeData[normalizedQuery];
        }
        
        // 2. T√¨m ki·∫øm b·∫±ng T·ª´ kh√≥a Quan tr·ªçng 
        const words = normalizedQuery.split('_').filter(word => word.length > 1 && !IGNORE_WORDS.includes(word));
        
        for (let i = 0; i < words.length; i++) {
            if (knowledgeData.hasOwnProperty(words[i])) {
                return knowledgeData[words[i]];
            }
            if (i < words.length - 1) {
                const twoWordsKey = `${words[i]}_${words[i+1]}`;
                if (knowledgeData.hasOwnProperty(twoWordsKey)) {
                    return knowledgeData[twoWordsKey];
                }
            }
            if (i < words.length - 2) {
                const threeWordsKey = `${words[i]}_${words[i+1]}_${words[i+2]}`;
                if (knowledgeData.hasOwnProperty(threeWordsKey)) {
                    return knowledgeData[threeWordsKey];
                }
            }
        }
        
        // 3. T√¨m ki·∫øm b·∫±ng t·ª´ kh√≥a c√≥ ch·ª©a 
        const keys = Object.keys(knowledgeData);
        for (const key of keys) {
            if (key.includes(normalizedQuery) || normalizedQuery.includes(key)) {
                return knowledgeData[key];
            }
        }

        return null;
    }


    function handleLearnCommand(input) {
        const learnRegex = /!hoc\s+([^=]+)\s*=\s*(.+)/i;
        const match = input.match(learnRegex);

        if (match) {
            const userKey = match[1].trim(); 
            const key = normalizeString(userKey); 
            const value = match[2].trim();

            if (userKey.length < 2 || value.length < 5) {
                return "‚ö†Ô∏è **L·ªói:** T·ª´ kh√≥a ph·∫£i c√≥ √≠t nh·∫•t 2 k√Ω t·ª± v√† N·ªôi dung ph·∫£i c√≥ √≠t nh·∫•t 5 k√Ω t·ª± ƒë·ªÉ h·ªçc.";
            }

            if (knowledgeData.hasOwnProperty(key)) {
                return `‚ö†Ô∏è **L·ªói:** T·ª´ kh√≥a \`${userKey}\` (Chu·∫©n h√≥a th√†nh: \`${key}\`) ƒë√£ t·ªìn t·∫°i. D√πng l·ªánh **!SUA ${userKey}=N·ªôi dung m·ªõi** ƒë·ªÉ ch·ªânh s·ª≠a.`;
            }

            knowledgeData[key] = value;
            saveState(); // L∆∞u l·∫°i ki·∫øn th·ª©c m·ªõi
            return `‚ú® **ƒê√£ h·ªçc th√†nh c√¥ng!** T·ª´ kh√≥a \`${userKey}\` (Key chu·∫©n: \`${key}\`) ƒë√£ ƒë∆∞·ª£c l∆∞u Vƒ®NH VI·ªÑN (Local Storage) v·ªõi n·ªôi dung: "${value.substring(0, 50)}..."`;
        } else {
            return "‚ö†Ô∏è **L·ªói c√∫ ph√°p:** C√∫ ph√°p h·ªçc l√† **!HOC T·ª´ kh√≥a=N·ªôi dung ki·∫øn th·ª©c** (V√≠ d·ª•: !HOC M√®o=M√®o l√† lo√†i ƒë·ªông v·∫≠t nh·ªè b√©, d·ªÖ th∆∞∆°ng).";
        }
    }

    function handleEditCommand(input) {
        const editRegex = /!sua\s+([^=]+)\s*=\s*(.+)/i;
        const match = input.match(editRegex);

        if (match) {
            const userKey = match[1].trim();
            const key = normalizeString(userKey);
            const value = match[2].trim();

            if (!knowledgeData.hasOwnProperty(key)) {
                return `‚ö†Ô∏è **L·ªói:** Kh√¥ng t√¨m th·∫•y t·ª´ kh√≥a \`${userKey}\` (Key chu·∫©n: \`${key}\`) ƒë·ªÉ s·ª≠a. Vui l√≤ng ki·ªÉm tra l·∫°i.`;
            }

            knowledgeData[key] = value;
            saveState(); // L∆∞u l·∫°i thay ƒë·ªïi
            return `‚úÖ **ƒê√£ s·ª≠a th√†nh c√¥ng v√† l∆∞u Vƒ®NH VI·ªÑN!** N·ªôi dung m·ªõi c·ªßa t·ª´ kh√≥a \`${userKey}\` (Key chu·∫©n: \`${key}\`) l√†: "${value.substring(0, 50)}..."`;
        } else {
            return "‚ö†Ô∏è **L·ªói c√∫ ph√°p:** C√∫ ph√°p s·ª≠a l√† **!SUA T·ª´ kh√≥a=N·ªôi dung m·ªõi** (V√≠ d·ª•: !SUA M√®o=M√®o l√† ƒë·ªông v·∫≠t nh·ªè th√≠ch ng·ªß).";
        }
    }
    
    function handleDeleteCommand(input) {
        const deleteRegex = /!xoa\s+(.+)/i;
        const match = input.match(deleteRegex);

        if (match) {
            const userKey = match[1].trim();
            const key = normalizeString(userKey);

            if (key === 'all') {
                if (confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a TO√ÄN B·ªò ki·∫øn th·ª©c ƒë√£ h·ªçc v√† l·ªãch s·ª≠ chat kh√¥ng?")) {
                    localStorage.removeItem(STORAGE_KEY_CHAT);
                    localStorage.removeItem(STORAGE_KEY_KNOWLEDGE);
                    location.reload();
                    return 'ƒê√£ x√≥a to√†n b·ªô l·ªãch s·ª≠ v√† ki·∫øn th·ª©c ƒë√£ h·ªçc.'; 
                }
                return 'H·ªßy x√≥a.';
            }
            
            if (knowledgeData.hasOwnProperty(key)) {
                delete knowledgeData[key];
                saveState(); // L∆∞u l·∫°i thay ƒë·ªïi
                return `üóëÔ∏è **ƒê√£ x√≥a th√†nh c√¥ng v√† l∆∞u Vƒ®NH VI·ªÑN!** T·ª´ kh√≥a \`${userKey}\` (Key chu·∫©n: \`${key}\`) ƒë√£ b·ªã lo·∫°i b·ªè.`;
            } else {
                return `‚ö†Ô∏è **L·ªói:** Kh√¥ng t√¨m th·∫•y t·ª´ kh√≥a \`${userKey}\` (Key chu·∫©n: \`${key}\`) ƒë·ªÉ x√≥a.`;
            }

        } else {
            return "‚ö†Ô∏è **L·ªói c√∫ ph√°p:** C√∫ ph√°p x√≥a l√† **!XOA T·ª´ kh√≥a** (V√≠ d·ª•: !XOA M√®o) ho·∫∑c **!XOA ALL** ƒë·ªÉ x√≥a h·∫øt (bao g·ªìm ki·∫øn th·ª©c ƒë√£ h·ªçc).";
        }
    }

    function handleViewCommand() {
        const keys = Object.keys(knowledgeData).sort();
        let listHtml = keys.length > 0 
            ? keys.map(key => `<li>\`${key}\`</li>`).join('')
            : 'Kh√¥ng c√≥ ki·∫øn th·ª©c n√†o trong b·ªô nh·ªõ.';
        
        return `üìñ **Danh s√°ch ${keys.length} t·ª´ kh√≥a hi·ªán c√≥ (ƒë√£ chu·∫©n h√≥a):**<ul class="keyword-list">${listHtml}</ul>`;
    }
    
    function handleContextualQuery(input) {
        const normalizedInput = input.trim().toLowerCase();
        if ((normalizedInput === 'th·∫ø √†' || normalizedInput === 'n√≥i th√™m' || normalizedInput === 'ti·∫øp ƒëi') && currentKnowledge) {
            return `Ti·∫øp t·ª•c ch·ªß ƒë·ªÅ: ${currentKnowledge}`;
        }
        return null;
    }

    // Bi·∫øn h√†m processMessage th√†nh ASYNC ƒë·ªÉ g·ªçi ƒë∆∞·ª£c await getNewQuote()
    async function processMessage(input) {
        const normalizedInput = input.trim();
        
        // 1. Ki·ªÉm tra c√°c l·ªánh ƒë·∫∑c bi·ªát
        if (normalizedInput.toUpperCase().startsWith('!HOC')) {
            return handleLearnCommand(normalizedInput);
        } else if (normalizedInput.toUpperCase().startsWith('!SUA')) {
            return handleEditCommand(normalizedInput);
        } else if (normalizedInput.toUpperCase().startsWith('!XOA')) {
            return handleDeleteCommand(normalizedInput);
        } else if (normalizedInput.toUpperCase() === '!XEM') {
            return handleViewCommand();
        } 
        // L·ªánh m·ªõi: K·∫øt n·ªëi Internet
        else if (normalizedInput.toUpperCase() === '!DANHGON') {
            return await getNewQuote(); // D√ôNG AWAIT ƒê·ªÇ CH·ªú K·∫æT QU·∫¢ T·ª™ INTERNET
        }


        // 2. X·ª≠ l√Ω ng·ªØ c·∫£nh
        const contextualResponse = handleContextualQuery(normalizedInput);
        if (contextualResponse) {
             return contextualResponse;
        }

        // 3. T√¨m ki·∫øm ki·∫øn th·ª©c b·∫±ng C√ÅCH LINH HO·∫†T (Ph∆∞∆°ng √°n 2)
        const knowledgeResponse = findFlexibleKnowledge(normalizedInput);
        if (knowledgeResponse) {
             return `üí° [PH·∫¢N H·ªíI KI·∫æN TH·ª®C] ${knowledgeResponse}`;
        }
        
        // 4. M·∫∑c ƒë·ªãnh
        return `T√¥i kh√¥ng t√¨m th·∫•y ki·∫øn th·ª©c v·ªÅ **${input}**. Vui l√≤ng nh·∫≠p **t·ª´ kh√≥a** ch√≠nh x√°c (ho·∫∑c th·ª≠ bi·∫øn th·ªÉ kh√¥ng d·∫•u) ho·∫∑c d√πng l·ªánh **!HOC** ƒë·ªÉ d·∫°y t√¥i ki·∫øn th·ª©c n√†y.`;
    }


    // Bi·∫øn h√†m sendMessage th√†nh ASYNC
    async function sendMessage() {
        const inputField = document.getElementById('user-input');
        const input = inputField.value.trim();

        if (input === '') return;

        const isContextual = input.trim().toLowerCase() === 'th·∫ø √†' || input.trim().toLowerCase() === 'n√≥i th√™m' || input.trim().toLowerCase() === 'ti·∫øp ƒëi';
        if (!isContextual) {
            currentKnowledge = null; 
        }

        appendMessage(input, 'user', true);
        inputField.value = '';

        // D√πng AWAIT ƒë·ªÉ ch·ªù processMessage (v√¨ n√≥ g·ªçi API)
        const botResponse = await processMessage(input);
        
        setTimeout(() => {
            appendMessage(botResponse, 'bot');
        }, 100);
    }
    
    document.getElementById('user-input').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            sendMessage();
        }
    });

    window.onload = loadChatbotData;

</script>
</body>
</html>